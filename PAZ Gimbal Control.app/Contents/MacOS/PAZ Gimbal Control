#!/bin/bash
# PAZ Gimbal Control - macOS Application Launcher

PROJECT_DIR="/Users/alexmacbookair/Documents/Code/PAZ_Gimbal_Control"

# Use osascript to run in Terminal with auto-close on exit
osascript << 'EOF'
tell application "Terminal"
    activate

    # Create a new terminal window with our script
    set newTab to do script "
        cd '/Users/alexmacbookair/Documents/Code/PAZ_Gimbal_Control'

        # Cleanup function
        cleanup() {
            echo ''
            echo 'ğŸ›‘ Shutting down PAZ Gimbal Control...'
            pkill -f 'zt_bridge.py' 2>/dev/null
            pkill -f 'vite preview' 2>/dev/null
            echo 'âœ… Servers stopped. Closing terminal...'
            sleep 1
            exit 0
        }

        # Trap Ctrl+C and exit
        trap cleanup INT TERM EXIT

        # Kill existing processes
        pkill -f 'zt_bridge.py' 2>/dev/null
        pkill -f 'vite preview' 2>/dev/null
        sleep 1

        echo 'ğŸš€ Starting PAZ Gimbal Control v1.2.0...'
        echo ''

        # Start Python server
        echo 'ğŸ“¡ Starting gimbal server...'
        python3 server/zt_bridge.py --virtual &
        SERVER_PID=$!
        sleep 2

        # Start web server
        echo 'ğŸŒ Starting web server...'
        npm run preview &
        WEB_PID=$!
        sleep 3

        # Open browser
        echo 'ğŸ”— Opening browser...'
        open http://localhost:4173

        echo ''
        echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
        echo '  âœ… PAZ Gimbal Control is running!'
        echo '  ğŸŒ Web UI: http://localhost:4173'
        echo '  ğŸ“¡ Server: http://localhost:3001'
        echo ''
        echo '  Press Ctrl+C to stop and close this window'
        echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
        echo ''

        # Wait for processes (keeps terminal alive)
        wait
    "

    # Get the window ID for later closing
    set windowID to id of front window

end tell
EOF
